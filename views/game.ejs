<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="/css/stylesheet.css" />
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <title></title>
  </head>
  <body>
    <div id="container">
      <div id="banner">
        <h1 class="header">Think fast, type faster!</h1>
      </div>
      <div id="infoContainer">
        <p v-if="gameStoped && startCounter == false">Hi <%=testObject%>!</p>
        <p v-if="gameStoped && startCounter == false">
          In order to start the game click button bellow.
        </p>
        <button
          v-on:click="startGame()"
          v-if="gameStoped && startCounter==false"
        >
          Start game
        </button>
        <button v-on:click="validateInput()">Index</button>
        <p v-if="startCounter">
          Get ready. Game is about to start! {{ counter }}
        </p>
        <p v-if="startCounter || gameStoped == false">
          Type given text as fast as you can. Good luck!{{gameCounter}}
        </p>
        <p v-if="gameStoped==false">{{ text[1] }}</p>
        <textarea
          v-if="gameStoped==false"
          placeholder="add multiple lines"
          id="inputField"
        ></textarea>
        <!-- <button v-on:click="getText()">Check fetch</button>  v-if="text"-->
      </div>
      <div id="footer">
        <h1 class="footer">&copy; Copyright 2021</h1>
      </div>
    </div>
    <script>
      // declare first Vue appp
      var app = new Vue({
        el: "#container",
        data: {
          text: JSON,
          gameStoped: true,
          counter: 5,
          startCounter: false,
          gameCounter: 0,
        },
        methods: {
          getText() {
            fetch("/text", {
              method: "GET",
              mode: "cors",
            })
              .then((res) => (data = res.json()))
              .then((data) => (this.text = data.text))
              .catch((err) => console.log(err.message));
          },
          intervalCounter() {
            let n = 0;
            let interval = setInterval(function () {
              if (n == 4) {
                clearInterval(interval)
                app.getText()
                app.gameStoped = false
                app.startCounter = false
                app.gameCounterFunction()
                app.validateInput()
              }
              n++;
              app.counter = app.counter - 1;
            }, 100);
          },
          startGame() {
            app.startCounter = true;
            app.intervalCounter();
          },
          validateInput(text) {
            let i = 0;
            let interval = setInterval(function () {
              i++;
              let inputField = document.getElementById("inputField").value;
              let index = inputField.length;
              let originalText = app.text[1].slice(0, index);
              let originalLength = app.text[1].length
              if(index<originalLength){
                if (inputField == originalText) {
                  document.getElementById("inputField").style = "color: green";
                } else {
                   document.getElementById("inputField").style = "color: red";
                } 
              }else{
                clearInterval(interval)
                alert("Well done! Your time: "+app.gameCounter+"seconds")
              }
            }, 100);
          },
          gameCounterFunction() {
            let n = 0;
            let interval = setInterval(function () {
              n++;
              app.gameCounter = app.gameCounter +1;
            }, 1000);
          },
        },
      });
    </script>
  </body>
</html>
